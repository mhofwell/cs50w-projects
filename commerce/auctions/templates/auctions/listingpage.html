{% extends "auctions/layout.html" %}

{% block body %}
<div>
    <h2>{{ listing.title }}</h2>
</div>
<div class=listing-page-body>
    <div>
        <img src="{{ listing.img_url }}">
    </div>
    <div class="listing-information">
        <div>
            <label class="form-label"><strong>Posted by: </strong>{{ listing.user }}</label>
        </div>
        <div>
            <label class="form-label"><strong>Created on: </strong>{{ listing.date_created }}</label>
        </div>
        <div>
            <label class="form-label"><strong>Price: </strong>${{ listing.starting_bid }}</label>
        </div>
        <div>
            {% if listing.highest_bid %}
            <label class="form-label"><strong>Current bid: </strong>${{ listing.highest_bid }}</label>
            {% else %}
            <label class="form-label"><strong>Current bid: </strong>No bidders yet.</label>
            {% endif %}
        </div>
        {% if user.is_authenticated %}
        <div>
            <a href="{% url 'add_to_watchlist' listing.id %}">Add to Watchlist</a>
        </div>
        {% endif %}
    </div>
    <div class="listing-information">
        <div>
            <label class="form-label"><strong>Description: </strong>{{ listing.description }}</label>
        </div>
    </div>
</div>
{% if user.is_authenticated %}
<form action="{% url 'bid' listing.title %}" method=POST>
    <!-- The error I think is because you're passing in listing.title as part of the request, try and remove it -->
    {%csrf_token%}
    <label><strong>Amount: </strong></label>
    <div class="listing-page-bid">
        {{ new_bid.bid }}
        <input type="submit" value="Bid" class="btn btn-primary" name="new_bid">
        <input type="hidden" value="{{ listing.current_bid }}">
        <input type="hidden" value="{{ listing.starting_bid }}">
        <input type="hidden" value="{{ listing.title }}">
    </div>
</form>
{% else %}
<div>
    Please login to bid!
</div>
{% endif %}
<div>
    {% for comment in comments %}
    {{ comment.comment }}
    {% endfor %}
</div>
<form action="{% url 'comment' %}">
    <label class="form-label-image"><strong>Add A Comment!</strong></label>
    {{ comment_form.comment}}
    <input type="submit" value="Comment" name="comment" class="btn btn-primary">
</form>



{% endblock %}